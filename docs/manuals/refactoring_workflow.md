# Commit Coach – リファクタリングワークフロー

_作成日:_ 2025-06-04

---

## 0. 全体像

> **ゴール:**
> コードの品質を高め、保守性を向上させながら、ポートフォリオとしての魅力を最大化する。
> リファクタリングプロセスの透明性と再現性を確保する。

---

## 1. ワークフロー設計

| フェーズ | ゴール | 手法／ツール | 具体的な進め方 |
|----------|-------|-------------|----------------|
| **1. イシュー駆動化** | _追える粒度_ に分解 | GitHub **Issues / Projects** | - Phase をエピック Issue 化<br>- チェックリスト項目を子 Issue 化<br>- Projects kanban で進捗可視化 |
| **2. ブランチ運用** | レビュー前提の小 PR 量産 | **GitHub Flow** | `feat/<scope>` / `chore/<scope>` → **≤300 行**で PR → rebase-merge |
| **3. PR レビュー設計** | 品質 & ストーリー担保 | PR テンプレ／コードオーナー | `.github/PULL_REQUEST_TEMPLATE.md` に:<br>・概要・スクショ<br>・必要性 (ポートフォリオ用途)<br>・動作確認手順 |
| **4. 自動テスト & CI** | 緑バッジで信頼性可視化 | **GitHub Actions** × **pnpm** | ワークフロー:`lint → type-check → jest → build`<br>TDD（テスト駆動開発）プロセスの実践 |
| **5. ドキュメント整備** | 仕様変更と同時に docs 更新 | `docs/` + **Markdown** | 同一 PR でドキュメントも修正<br>技術的決定の記録を残す |

---

## 2. リファクタリングプロセス

### 2.1. リファクタリング前の準備

1. **現状分析**
   - コードの問題点・技術的負債の特定
   - パフォーマンスボトルネックの測定
   - 保守性に関する評価

2. **スコープ定義**
   - リファクタリング対象の明確化
   - 変更の影響範囲の見積もり
   - 優先順位の設定

3. **テスト整備**
   - リファクタリング前のテストカバレッジ確認
   - 不足テストの追加
   - 回帰テストの準備

### 2.2. リファクタリング中のプロセス

1. **小さな変更の積み重ね**
   - 1つの機能/コンポーネントごとに変更
   - 各ステップで動作確認とテスト実行
   - コミットメッセージの明確化（変更意図を記録）

2. **段階的なレビューと反映**
   - 変更ごとにセルフレビュー
   - 必要に応じて PR を小分けにする
   - マージ後の統合テスト実行

3. **ドキュメント更新**
   - 設計変更の記録
   - README や API ドキュメントの更新
   - コード内のコメント整備

### 2.3. リファクタリング後の評価

1. **成果の測定**
   - パフォーマンス指標の比較
   - コード品質メトリクスの確認
   - テストカバレッジの変化

2. **学習の記録**
   - 発見した問題点と解決策
   - 採用したパターンと理由
   - 今後の改善点

---

## 3. TDD 用チェックリスト

```text
- [ ] ユニットテスト：個別機能のテスト
- [ ] 統合テスト：コンポーネント間の連携テスト
- [ ] E2Eテスト：ユーザーフローの確認
- [ ] パフォーマンステスト：速度と応答性の検証
```

1. **失敗するテストを先に作成**
2. **最小限の実装でテストを通す**
3. **リファクタリングでコードを改善**
4. **テストが常に通ることを確認**

---

## 4. リファクタリング対象の優先度設定

| 優先度 | 観点 | 具体例 |
|-------|------|-------|
| 高 | ユーザー体験に直結する問題 | レスポンス遅延、UI不具合、クラッシュ |
| 中 | 開発効率・保守性の向上 | コンポーネント分割、型定義の改善、重複コード除去 |
| 低 | コード美学・整理整頓 | ファイル構成最適化、命名規則の統一 |

---

## 5. コミットメッセージ規約

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type:**
- `refactor`: リファクタリング（機能変更なし）
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: フォーマットの修正（空白、整形等）
- `perf`: パフォーマンス改善
- `test`: テストの追加・修正

**例:**
```
refactor(hooks): useChat フックの分割と責務の明確化

- API通信ロジックを別フックに分離
- エラーハンドリングの統一化
- 型定義の強化

Issue: #42
```

---

## 6. ドキュメント更新ルール

- リファクタリングの **意図** と **利点** を必ず記録する
- 技術的な決定と代替案の検討プロセスを残す
- コードの変更と同時にドキュメントも更新する
- 重要な変更は `CHANGELOG.md` にも追記する

---

*このドキュメントは Commit Coach プロジェクトのリファクタリングワークフローを定義します。
チーム全体での一貫したアプローチを確保するためのガイドラインです。*
