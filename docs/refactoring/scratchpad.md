# 🗒️ Commit Coach Scratchpad — Hierarchical Checklist

*ネストされたチェックリスト ( `[ ]` / `[x]` ) だけで進捗を管理する軽量テンプレ*

---

## ルール (最短版)

1. **1 行 1 項目** — 親 → 子 → 孫 … とインデント 2 スペースでネスト。
2. **\[ ] 未完 / \[x] 完了** を切り替えるだけ。期日やメモは必要に応じて末尾 `(MM‑DD)`。
3. **親がすべて \[x] になったら自動で折りたたみ表示 (GitHub UI)**。

<details>
<summary>多層構造のチェックリスト記法サンプル</summary>

```markdown
- [ ] 🏁 リリース準備 (06‑10)
  - [ ] ビルド最終確認 @Taro
  - [ ] Netlify ステージングデプロイ @Sara
    - [ ] env 変数反映 (06‑08)
  - [ ] QA リグレッション @Alex
- [ ] ドキュメント更新 @Mia (06‑09)
```

</details>

---

## Backlog

* [ ] 🌱 新機能アイデア

  * [ ] AI でタスク見積もり
  * [ ] ダークモード自動切替

---

## Doing

* [x] 📚 **docs/refactoring ドキュメント確定** (05‑31)

  * [x] 01〜09.md 校閲 @nakazawatarou
  * [x] spell‑check & linter 実行
  * [x] Reviewer アサイン (@tech‑lead, @ux)
* [x] 📨 **ドキュメントをリポジトリに push** (05‑31)

  * [x] `docs/refactoring` に配置
  * [x] `git add && commit -m "docs: add x_docs_refactoring"`
  * [x] GitHub PR 作成 (draft)
* [ ] 🏗 **フロント移行タスクの着手** (06‑01)

  <!-- * [x] `feature/remove-dashboard` 最新リベース -->
  * [x] Storybook import エラー修正 (`Cascade > Fix imports`)
  * [x] `pnpm test` & `pnpm lint` で green に

---

## Blockers

* [ ] Supabase Edge Function 削除に伴う Zapier Hook 影響範囲調査 (担当未定)

---

## Done

* [x] Scratchpad 雛形決定 & 反映 (05‑30)

---

## Ideas

* [ ] Postgres → ClickHouse 移行調査

-------------------------------------------------

# Commit Coach – **Ver 0** 要件定義書

*作成日: 2025‑05‑30
**Windsurf** のバックログボードにそのまま貼り付けられる形式*

---

## 1. 目的

48 時間以内に **クリック可能な公開デモ** を構築し、*Commit Coach* の核心価値（AI による習慣形成支援）を体験できるようにする。同時に、今後の Ver 1 以降へ拡張しやすい最小限の土台を用意する。

> **Ver 0 の成功指標**: レビュワーがログインし、選択したトーンで AI コーチとチャットし、「コミット → フィードバック」を途切れず体験できる。

---

## 2. スコープ（MoSCoW）

| 優先度              | Epic / 機能                                                                                                                                                                                                          |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Must**         | 1. **Supabase メール認証**（Magic‑Link のみ）<br>2. **AI コーチングチャット** MVP（スレッド 1 本）<br>3. **トーンプリセット** 選択（3 種類）<br>4. **ランディングページ**（Hero + CTA）<br>5. **マイページ** 骨組み（直近チャット表示）<br>6. **Vercel デプロイ**（Storybook ビルドは CI でスキップ） |
| **Should**       | 7. Storybook ローカル復旧<br>8. 404 ページ & Error Boundary                                                                                                                                                                 |
| **Could**        | 9. Lighthouse 簡易チェック（スコア 60 以上）                                                                                                                                                                                    |
| **Won’t（Ver 0）** | Todo 管理、リマインダー、ダークモード、モバイル PWA、分析、OAuth ソーシャルログイン                                                                                                                                                                  |

---

## 3. ユーザーストーリー

1. **U‑1 ログイン** — *初回訪問者* はメールアドレスで Magic‑Link を受け取り、ログインできる。
2. **U‑2 チャット** — *ログイン済みユーザー* はメッセージを送り、AI から返信を受け取れる。
3. **U‑3 トーン選択** — *ユーザー* は「Friendly / Tough‑Love / Humor」のトーンを切り替え、AI の口調を変えられる。
4. **U‑4 再訪** — *再訪ユーザー* は **/mypage** で前回の会話を続行できる。

---

## 4. 機能要件

| ID       | 要件                    | 受け入れ基準                                                                                                        |
| -------- | --------------------- | ------------------------------------------------------------------------------------------------------------- |
| **FR‑1** | **メール Magic‑Link 認証** | (a) メール入力 → 60 秒以内にリンク受信。<br>(b) クリックで Supabase `users` 行が作成/更新。<br>(c) セッションクッキー 7 日保持。                      |
| **FR‑2** | **チャットエンドポイント**       | (a) POST `/api/chat` がユーザーメッセージを `messages` 表へ保存し、OpenAI ストリームを返す。<br>(b) 30 秒タイムアウト時はトーストで通知。                |
| **FR‑3** | **トーンプリセット**          | (a) チャットヘッダーにドロップダウン、初期値「Friendly」。<br>(b) 選択したトーンが system プロンプトに埋め込まれる。<br>(c) `profiles.tone` に保存し次回デフォルトに。 |
| **FR‑4** | **ランディングページ**         | (a) 未ログインでも閲覧可。<br>(b) 製品タグライン、モック画像、CTA ボタン「Get Started」。                                                    |
| **FR‑5** | **マイページ**             | (a) 非ログイン時は /login へリダイレクト。<br>(b) 直近 10 件のチャットペアを新しい順に表示。                                                    |
| **FR‑6** | **デプロイ**              | (a) Vercel の公開 URL を取得。<br>(b) `.env` 変数を README に記載。<br>(c) ビルド時間 5 分以内。                                     |

---

## 5. 非機能要件

* **パフォーマンス** — デスクトップで初回 TTI < 3 秒。
* **信頼性** — 稼働率 95%、混雑時は「Service busy」トースト。
* **セキュリティ** — 全テーブルに Supabase **RLS** (`user_id = auth.uid()`)。
* **アクセシビリティ** — チャット入力と送信ボタンがキーボード操作可能 (WCAG 2.1 AA)。
* **保守性** — `pnpm lint` と `pnpm typecheck` を通過。

---

## 6. 技術スタックと制約

| レイヤー    | 採用技術                                           | 備考                            |
| ------- | ---------------------------------------------- | ----------------------------- |
| フロントエンド | Next.js 14, React 18, TypeScript, Tailwind CSS | App Router／Server Actions は任意 |
| AI      | OpenAI Chat API（gpt‑4o もしくは 3.5‑turbo）         | デモ予算上限 2 USD                  |
| バックエンド  | Supabase（Postgres 15, Edge Functions）          | pgvector は Ver 0 では未使用        |
| インフラ    | Vercel Free Tier                               | カスタムドメインは任意                   |

---

## 7. マイグレーション／アップグレードメモ（Ver 1 へ向けて）

* **タスク & リマインダー** テーブルを追加予定。`messages` スキーマと競合しない。
* リマインド用メールテンプレートは後日 `resend` に移行。
* ダーク／ライトテーマ切替は Tailwind の `dark:` クラスで実装予定。
* モバイル PWA 化は `next-pwa` 導入を想定。

---

## 8. 未確定事項

1. トーンプリセット 3 種の具体的な文面。
2. ユーザーあたりのレートリミット方法（ハードコード vs Supabase 関数）。
3. 認証なしの体験版チャットを提供するかどうか。

---

## 9. 用語集

| 用語                | 定義                                                    |
| ----------------- | ----------------------------------------------------- |
| **トーンプリセット**      | コーチの人格を変えるあらかじめ用意した system プロンプト。                     |
| **Magic‑Link**    | Supabase が発行するワンタイム JWT を含むパスワードレスサインイン用メール。          |
| **Edge Function** | ユーザー近くで実行される Supabase のサーバーレス関数。本 Ver ではチャットプロキシのみ利用。 |

---

*以上 — Windsurf へインポート可能な Markdown 完成*






<!-- End of File -->
