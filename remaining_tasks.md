# remaining_tasks.md

# Commit Coach プロジェクト - 未完了タスク調査

## 概要

本ドキュメントは Commit Coach プロジェクトの未完了タスクを包括的に調査し、ChatGPT O3 による分析のためにまとめたものです。現在の開発ステータスと今後取り組むべき優先事項を明確化します。

## 現在の進捗状況

### 完了済みの主要タスク

- ✅ docs/refactoring ドキュメント確定と関連校閲・レビュー (05-31)
- ✅ ドキュメントをリポジトリに push 作業 (05-31)
<!-- - ✅ `feature/remove-dashboard` 最新リベース -->
- ✅ Storybook import エラー修正
- ✅ pnpm test & pnpm lint でグリーン確認

## 現在の問題点（2025-06-05調査）

### AI機能の問題

現在、AI機能（タスク分解機能とチャット機能）が正常に動作していません。コンソールエラーには「AI からの応答取得に失敗しました」と表示されています。

#### 問題の詳細

1. **Supabase Edge Function未デプロイ**：
   - `chat`関数のコードは実装されていますが、Supabaseにデプロイされていません
   - `task_breakdown`関数は実装されておらず、Supabaseにも存在しません
   - これらの関数はAIとの対話を処理するために必要です

2. **認証とデモモードの問題**：
   - `.env.local`に`NEXT_PUBLIC_DEMO_MODE=false`を設定したため、実際のAPIを使用しようとしています
   - しかし、APIエンドポイントが存在しないため、リクエストが失敗しています
   - デモモードでは汎用的なダミーデータを返していましたが、現在は無効になっています

3. **Supabaseデプロイ時の認証エラー**：
   - Supabase CLIでのデプロイ時に認証エラーが発生しています
   - エラー: `Access token not provided. Supply an access token by running supabase login`

#### 選択肢と解決策

この問題に対処するために、以下の3つの選択肢があります：

1. **デモモードを再度有効化する**（最も簡単）：
   - `.env.local`ファイルの`NEXT_PUBLIC_DEMO_MODE`を`true`に変更する
   - ブラウザのCookieで`demo_mode=true`を設定する
   - この方法で、ダミーデータを使用した機能テストが可能になります

2. **Supabase Edge Functionをデプロイする**（完全版）：
   - Supabaseアカウントにログインする（`npx supabase login`）
   - `task_breakdown`関数を完成させる（実装済み、未デプロイ）
   - 両方の関数をデプロイする（`npx supabase functions deploy chat task_breakdown`）
   - `.env.local`の設定を見直し、必要なAPIキーを確認する

3. **他の優先度の高いタスクに取り組む**：
   - AI機能の修正は一時的に保留し、他の機能実装や修正に集中する
   - 後日、Supabase専門家の支援を得て問題を解決する

この問題は引き継ぎ作業の重要な部分であり、このドキュメントはWindsurfからの一時的な切断後も作業を継続するための参考資料となります。ChatGPT O3による分析も活用して、最適な解決策を選択していくことをお勧めします。
- ✅ AIタスク分解機能のAPI実装とフロントエンド連携 (06-04)
- ✅ 日本語IME入力時のユーザビリティ改善 (06-04)
- ✅ テストドキュメントの更新と本番環境テストの注意点追加 (06-04)



### 着手中/未完了のタスク

- [ ] AIタスク分解機能の本番環境テストと動作確認
- [ ] AIタスク分解のプロジェクト特性に応じた回答品質の改善
- [ ] `HierarchicalTaskItem`コンポーネントの型エラー修正

#### 1. 🏗 フロント移行タスク (06-01)
- サブタスクは全て完了しているが、親タスク自体の完了チェックがまだ行われていない
- フロントエンド移行の総合的な検証が必要かどうかの判断が必要

#### 2. ブロッカー
- Supabase Edge Function 削除に伴う Zapier Hook 影響範囲調査（担当未定）
  - 技術的依存関係の明確化が必要
  - 代替手段の検討と実装計画

#### 3. バックログ（新機能アイデア）
- AI でタスク見積もり機能
- ダークモード自動切替
- Postgres → ClickHouse 移行調査

## リファクタリング要件の実装状況

<!-- ### ダッシュボード編集機能
- EditableHierarchicalTaskItem コンポーネントへの移行が未完了
- ダブルクリックでのタイトル編集機能実装
- ペンアイコンを常時表示する UI 改善 -->

### Drag-and-Drop 実装
- @dnd-kit ライブラリを使用した実装は完了
- ドラッグ中のビジュアルフィードバック
- ドロップ領域の視覚的明確化
- React 19 との互換性確保

### ステータス属性リファクタリング
- Task 型の status を 'today' | 'unscheduled' | 'done' に変更
- 旧データ移行スクリプト作成
<!-- - use-dashboard をフィルタ方式へ書き換え
- DashboardNestedList のラベル動的化 -->
- /projects ページの projectId フィルタ変更

## Ver 0 要件との照合

### Must 要件
1. **Supabase メール認証**（Magic-Link のみ）- 実装状況不明
2. **AI コーチングチャット** MVP（スレッド 1 本）- 実装状況不明
3. **トーンプリセット** 選択（3 種類）- 実装状況不明
4. **ランディングページ**（Hero + CTA）- 実装状況不明
5. **マイページ** 骨組み（直近チャット表示）- 実装状況不明
6. **Vercel デプロイ**（Storybook ビルドは CI でスキップ）- 実装状況不明

### Should 要件
7. Storybook ローカル復旧 - 一部対応済み（import エラー修正完了）
8. 404 ページ & Error Boundary - 実装状況不明

### Could 要件
9. Lighthouse 簡易チェック（スコア 60 以上）- 実装状況不明

## 技術的な課題

1. **コンポーネント間の整合性**
   - DashboardItemRow と EditableHierarchicalTaskItem の props 構造の差異解消
   - 編集状態管理方法の統一（複数実装の混在）

2. **データ管理**
   - localStorage から Supabase への切り替え検討
   - データ移行戦略の具体化

3. **UX 改善**
   - UI リファクタリング（白カード + 薄い枠線/角丸）
   - 階層インデントの最適化
   - Chevron + Checkbox + タイトルの配置
   - 行ホバー効果の実装
   - 余白調整（左右 200px 程度）

## 次のステップ提案

1. ブロッカーとなっている Zapier Hook 影響範囲調査の担当者決定と着手
2. フロント移行タスクの完了確認と正式クローズ
3. Must 要件の未実装項目の優先実装（特に認証とデプロイ関連）
4. UI/UX リファクタリングの段階的実施
5. データ管理戦略の確定とマイグレーションパス設計

## 質問事項

1. Vercel と Netlify のどちらをデプロイ先として最終決定するか？
2. AIコーチサイドバーの初期表示状態はどうあるべきか？
3. D&D 機能の一時的なオフ化とプルダウン代替の是非
4. 新機能アイデアの優先順位付け

## 作業予定と優先順位

### 木曜日（2025年6月5日）の優先課題

1. **本番環境でのAIタスク分解機能テスト** ★★★
   - 実際のAIレスポンスを確認し、プロジェクト内容に合わせた分解が行われるか確認
   - `docs/testing/functional_tests.md` に結果を記録

2. **タスク優先度変更機能の実装** ★★
   - UI実装とZustandストアの状態更新機能の追加
   - ドラッグアンドドロップまたはボタンUIでの実装検討

3. **`HierarchicalTaskItem`コンポーネントの型エラー修正** ★
   - 型エラーの解消およびUIコンポーネントの改善付け

---

*本ドキュメントは現在のプロジェクト状況に基づいて作成されました。ChatGPT O3 による分析を通じて、次のアクションプランを策定することを目的としています。*
